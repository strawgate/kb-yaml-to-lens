version: '3.8'

services:
  generator:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        NODE_VERSION: 20.19.4
        KIBANA_VERSION: main
    volumes:
      # Output JSON files
      - ./output:/tool/output
      # Mount examples directory for live editing
      - ./examples:/tool/examples:ro
      # Cache Kibana node_modules between runs
      - kibana_node_modules:/kibana/node_modules
      # Cache yarn cache
      - yarn_cache:/root/.cache/yarn
    environment:
      - NODE_OPTIONS=--max_old_space_size=8192
      - OUTPUT_DIR=/tool/output
      - NODE_PATH=/kibana/node_modules
    mem_limit: 10g

volumes:
  kibana_node_modules:
  yarn_cache:
