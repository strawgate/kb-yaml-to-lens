---
name: Tidy PR Comments
on:
  issue_comment:
    types:
      - created
permissions:
  contents: read
  pull-requests: write
  issues: write
jobs:
  tidy:
    if: |
      github.event.issue.pull_request &&
      contains(github.event.comment.body, '/tidy')
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      - name: Tidy PR comments
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |-
          OWNER=${{ github.repository_owner }}
          REPO=${{ github.event.repository.name }}
          PR_NUMBER=${{ github.event.issue.number }}
          echo "Minimizing outdated comments for PR #${PR_NUMBER}..."
          if ! make gh-minimize-outdated-comments "$OWNER" "$REPO" "$PR_NUMBER"; then
            gh api "repos/$OWNER/$REPO/issues/$PR_NUMBER/comments" \
              -f body="‚ùå Failed to minimize outdated comments. Check workflow logs for details."
            exit 1
          fi
