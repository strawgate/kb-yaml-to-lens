# Test ESQL array queries with YAML anchors
# This demonstrates how to share query parts across multiple panels

# Define reusable query parts using YAML anchors
base_from: &base_from "FROM logs-*"
time_filter: &time_filter "WHERE @timestamp > NOW() - 1h"

dashboards:
-
  name: "ESQL Array Query with Anchors Test"
  panels:
    # Panel 1: Using array format with anchors
    - type: lens_esql
      grid_data: { x: 0, y: 0, w: 12, h: 8 }
      esql:
        - *base_from
        - *time_filter
        - "STATS error_count = COUNT(*) BY service.name"
        - "LIMIT 20"
      chart:
        type: metric
        primary:
          field: "error_count"

    # Panel 2: Reusing the same base parts with different aggregation
    - type: lens_esql
      grid_data: { x: 12, y: 0, w: 12, h: 8 }
      esql:
        - *base_from
        - *time_filter
        - "STATS total = COUNT(*)"
      chart:
        type: metric
        primary:
          field: "total"
